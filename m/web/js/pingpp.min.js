!function(){function e(e,a,i){var n=document.createElement("form");n.setAttribute("method",a),n.setAttribute("action",e);for(var t in i)if(r.call(i,t)){var l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name",t),l.setAttribute("value",i[t]),n.appendChild(l)}document.body.appendChild(n),n.submit()}function a(e,a,i){"undefined"==typeof i&&(i=!1);var r=[];for(var n in e)("bfb_wap"!=a||"url"!=n)&&("yeepay_wap"!=a||"mode"!=n)&&r.push(n+"="+(i?encodeURIComponent(e[n]):e[n]));return r.join("&")}var i="2.0.7",r={}.hasOwnProperty,n=function(){},t={PINGPP_NOTIFY_URL:"https://api.pingxx.com/notify/charges/",UPACP_WAP_URL:"https://gateway.95516.com/gateway/api/frontTransReq.do",ALIPAY_WAP_URL:"http://wappaygw.alipay.com/service/rest.htm",UPMP_WAP_URL:"uppay://uppayservice/?style=token&paydata=",JDPAY_WAP_URL:"https://m.jdpay.com/wepay/web/pay",YEEPAY_WAP_URL:"https://ok.yeepay.com/paymobile/api/pay/request",YEEPAY_WAP_TEST_URL:"http://mobiletest.yeepay.com/paymobile/api/pay/request",PINGPP_MOCK_URL:"http://sissi.pingxx.com/mock.php"},l={alipay_wap:"alipay_wap",upmp_wap:"upmp_wap",upacp_wap:"upacp_wap",bfb_wap:"bfb_wap",wx_pub:"wx_pub",yeepay_wap:"yeepay_wap",jdpay_wap:"jdpay_wap"};n.prototype={version:i,_resultCallback:void 0,_jsApiParameters:{},_debug:!1,_signature:void 0,createPayment:function(i,n,_,o){"function"==typeof n&&(this._resultCallback=n),"undefined"!=typeof _&&(this._signature=_),"boolean"==typeof o&&(this._debug=o);var s;if("string"==typeof i)try{s=JSON.parse(i)}catch(c){return void this._innerCallback("fail",this._error("json_decode_fail"))}else s=i;if("undefined"==typeof s)return void this._innerCallback("fail",this._error("json_decode_fail"));if(!r.call(s,"id"))return void this._innerCallback("fail",this._error("invalid_charge","no_charge_id"));if(!r.call(s,"channel"))return void this._innerCallback("fail",this._error("invalid_charge","no_channel"));var p=s.channel;if(!r.call(s,"credential"))return void this._innerCallback("fail",this._error("invalid_charge","no_credential"));if(!s.credential)return void this._innerCallback("fail",this._error("invalid_credential","credential_is_undefined"));if(!r.call(l,p))return void this._innerCallback("fail",this._error("invalid_charge","no_such_channel:"+p));if(!r.call(s.credential,p))return void this._innerCallback("fail",this._error("invalid_credential","no_valid_channel_credential"));if(!r.call(s,"livemode"))return void this._innerCallback("fail",this._error("invalid_charge","no_livemode"));if(0==s.livemode)return void this._testModeNotify(s);var d=s.credential[p];if(p==l.upmp_wap)location.href=t.UPMP_WAP_URL+d.paydata;else if(p==l.upacp_wap)e(t.UPACP_WAP_URL,"post",d);else if(p==l.alipay_wap)if(d._input_charset="utf-8","undefined"!=typeof _AP){var f=a(d,p,!0);_AP.pay(t.ALIPAY_WAP_URL+"?"+f)}else e(t.ALIPAY_WAP_URL,"get",d);else if(p==l.bfb_wap){if(!r.call(d,"url"))return void this._innerCallback("fail",this._error("invalid_credential","missing_field:url"));location.href=d.url+"?"+a(d,p)}else if(p==l.yeepay_wap){for(var u=["merchantaccount","encryptkey","data"],h=0;h<u.length;h++)if(!r.call(d,u[h]))return void this._innerCallback("fail",this._error("invalid_credential","missing_field_"+u[h]));location.href=r.call(d,"mode")&&"test"==d.mode?t.YEEPAY_WAP_TEST_URL+"?"+a(d,p,!0):t.YEEPAY_WAP_URL+"?"+a(d,p,!0)}else if(p==l.wx_pub){for(var u=["appId","timeStamp","nonceStr","package","signType","paySign"],h=0;h<u.length;h++)if(!r.call(d,u[h]))return void this._innerCallback("fail",this._error("invalid_credential","missing_field_"+u[h]));this._jsApiParameters=d,this._callpay()}else p==l.jdpay_wap&&e(t.JDPAY_WAP_URL,"post",d)},_jsApiCall:function(){var e=this;e._jsApiParameters!={}&&WeixinJSBridge.invoke("getBrandWCPayRequest",e._jsApiParameters,function(a){"get_brand_wcpay_request:ok"==a.err_msg?e._innerCallback("success"):"get_brand_wcpay_request:cancel"==a.err_msg?e._innerCallback("cancel"):e._innerCallback("fail",e._error("wx_result_fail",a.err_msg))})},_callpay:function(){function e(){a._jsApiCall()}var a=this;if("undefined"!=typeof wx&&"undefined"!=typeof a._signature){var i=!1;wx.config({debug:a._debug,appId:a._jsApiParameters.appId,timestamp:a._jsApiParameters.timeStamp,nonceStr:a._jsApiParameters.nonceStr,signature:a._signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){i||wx.chooseWXPay({timestamp:a._jsApiParameters.timeStamp,nonceStr:a._jsApiParameters.nonceStr,"package":a._jsApiParameters["package"],signType:a._jsApiParameters.signType,paySign:a._jsApiParameters.paySign,success:function(e){"chooseWXPay:ok"==e.errMsg?a._innerCallback("success"):a._innerCallback("fail",a._error("wx_result_fail",e.errMsg))},cancel:function(){a._innerCallback("cancel")},fail:function(e){a._innerCallback("fail",a._error("wx_result_fail",e.errMsg))}})}),wx.error(function(e){i=!0,a._innerCallback("fail",a._error("wx_config_error",e.errMsg))})}else"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",e,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",e),document.attachEvent("onWeixinJSBridgeReady",e)):this._jsApiCall()},_error:function(e,a){return e="undefined"==typeof e?"":e,a="undefined"==typeof a?"":a,{msg:e,extra:a}},_innerCallback:function(e,a){"function"==typeof this._resultCallback&&("undefined"==typeof a&&(a=this._error()),this._resultCallback(e,a))},_testModeNotify:function(e){var i=this;if(e.channel==l.wx_pub){var n=confirm("模拟付款？");if(n){var _=new XMLHttpRequest;_.open("GET",t.PINGPP_NOTIFY_URL+e.id+"?livemode=false",!0),_.onload=function(){if(_.status>=200&&_.status<400&&"success"==_.responseText)i._innerCallback("success");else{var e="http_code:"+_.status+";response:"+_.responseText;i._innerCallback("fail",i._error("testmode_notify_fail",e))}},_.onerror=function(){i._innerCallback("fail",i._error("network_err"))},_.send()}else i._innerCallback("cancel")}else{var o={ch_id:e.id,scheme:"http",channel:e.channel};r.call(e,"order_no")?o.order_no=e.order_no:r.call(e,"orderNo")&&(o.order_no=e.orderNo),r.call(e,"time_expire")?o.time_expire=e.time_expire:r.call(e,"timeExpire")&&(o.time_expire=e.timeExpire),r.call(e,"extra")&&(o.extra=encodeURIComponent(JSON.stringify(e.extra))),location.href=t.PINGPP_MOCK_URL+"?"+a(o)}}},n.prototype.payment=n.prototype.createPayment,window.pingpp=new n,window.PINGPP_PAY_SDK=window.PINGPP_WX_PUB=window.pingpp}();