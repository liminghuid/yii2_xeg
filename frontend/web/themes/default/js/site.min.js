Zhai={baseUrl:"",cart:{length:0,volume:0,storeId:0,isRest:0,atLeast:0,add:function(t,a){$.ajax({url:Zhai.baseUrl+"/cart/add",type:"post",dataType:"json",data:{goodsId:t},success:function(t){"ok"===t.status?"function"==typeof a&&a(t):t.msg&&alert(t.msg)},error:function(){}})},subtract:function(t,a){$.ajax({url:Zhai.baseUrl+"/cart/subtract",type:"post",dataType:"json",data:{goodsId:t},success:function(t){"ok"===t.status?"function"==typeof a&&a(t):t.msg&&alert(t.msg)},error:function(){}})},refresh:function(){$.ajax({url:Zhai.baseUrl+"/cart/refresh",type:"post",dataType:"json",data:{storeId:this.storeId},success:function(t){"ok"===t.status&&($(".shopping-list").empty().html(t.html),$(".shopping-list li").each(function(t){var a=$(this),i=parseInt(a.attr("data-goodsId")),s=$('.sale-item[data-goodsid="'+i+'"]'),o=function(t){s.find(".stock span").text(t.surplus),s.find(".quantity-count").text(t.cart),s.find(".quantity").attr("data-max",t.surplus),s.find(".quantity-minus").prop("disabled",t.cart<1),s.find(".quantity-plus").prop("disabled",t.cart>=t.surplus),Zhai.cart.refresh()};a.find(".quantity-minus").click(function(){Zhai.cart.subtract(i,o)}),a.find(".quantity-plus").click(function(){Zhai.cart.add(i,o)}),a.find(".delete button").click(function(){Zhai.cart.del(i)})}),Zhai.quantity.refreshAll(),Zhai.cart.length=parseInt(t.length),Zhai.cart.volume=t.volume,$(".shopping-bottom .price span").text(Zhai.cart.volume),Zhai.cart.isRest||(Zhai.cart.atLeast>Zhai.cart.volume?$(".shopping-btn a").addClass("disabled").text("还差"+(Zhai.cart.atLeast-Zhai.cart.volume).toFixed(2)+"元"):($(".shopping-btn a").html('选好了 <i class="fa fa-long-arrow-right"></i>'),Zhai.cart.length<1?$(".shopping-btn a").addClass("disabled"):$(".shopping-btn a").removeClass("disabled"))),$(".shopping-list .link-view").click(Zhai.detail.viewHandle))},error:function(){}})},clear:function(){$.ajax({url:Zhai.baseUrl+"/cart/clear",type:"post",dataType:"json",data:{storeId:this.storeId},success:function(t){"ok"===t.status&&(Zhai.cart.refresh(),$(".wrapper .quantity-count").text("0"),Zhai.quantity.refreshAll())},error:function(){}})},del:function(t){$.ajax({url:Zhai.baseUrl+"/cart/delete",type:"post",dataType:"json",data:{goodsId:t},success:function(t){"ok"===t.status&&Zhai.cart.refresh()},error:function(){}})},init:function(){this.storeId=parseInt($(".shopping-cart").attr("data-storeId")),this.isRest=parseInt($(".shopping-cart").attr("data-isRest")),this.atLeast=parseFloat($(".shopping-cart").attr("data-least"))}},user:{isGuest:!0,showLogin:function(){$("#modal-login").modal("show")},init:function(){this.isGuest=Boolean($("html").attr("data-isGuest"))}},detail:{goodsId:0,cart:0,surplus:0,refreshQuantity:function(){var t=$("#modal-goods .quantity");t.find(".quantity-minus").prop("disabled",this.cart<1),t.find(".quantity-plus").prop("disabled",this.cart>=this.surplus)},load:function(t){$.ajax({url:Zhai.baseUrl+"/goods/detail?id="+t,type:"post",dataType:"json",success:function(a){"ok"===a.status&&($("#modal-goods h4").text(a.name),$("#modal-goods p").text(a.description),$("#modal-goods .price span").text(a.price),$("#modal-goods .quantity-count").text(a.cart),$("#modal-goods .modal-header").css("background-image","url("+a.image+")"),Zhai.detail.goodsId=t,Zhai.detail.cart=a.cart,Zhai.detail.surplus=a.surplus,Zhai.detail.refreshQuantity())},error:function(){}})},show:function(){$("#modal-goods").modal("show")},viewHandle:function(){var t=parseInt($(this).attr("data-goodsId"));return Zhai.detail.load(t),Zhai.detail.show(),!1},init:function(){var t=function(t){var a=$('.sale-item[data-goodsid="'+Zhai.detail.goodsId+'"]');a.find(".stock span").text(t.surplus),a.find(".quantity-count").text(t.cart),a.find(".quantity").attr("data-max",t.surplus),$("#modal-goods .quantity-count").text(t.cart),Zhai.detail.cart=t.cart,Zhai.detail.surplus=t.surplus,Zhai.detail.refreshQuantity(),a.find(".quantity-minus").prop("disabled",t.cart<1),a.find(".quantity-plus").prop("disabled",t.cart>=t.surplus),Zhai.cart.refresh()};$("#modal-goods .quantity-minus").click(function(){Zhai.cart.subtract(Zhai.detail.goodsId,t)}),$("#modal-goods .quantity-plus").click(function(){Zhai.cart.add(Zhai.detail.goodsId,t)}),$(".link-view").click(Zhai.detail.viewHandle)}},quantity:{refreshAll:function(){$(".wrapper .quantity").each(function(t){var a=$(this),i=parseInt(a.attr("data-max")),s=parseInt(a.find(".quantity-count").text());a.find(".quantity-minus").prop("disabled",1>s),a.find(".quantity-plus").prop("disabled",s>=i)})}},goods:{traversalHandle:function(t){var a=$(this),i=a.find(".quantity"),s=parseInt(a.attr("data-goodsId")),o=function(t){a.find(".stock span").text(t.surplus),a.find(".quantity-count").text(t.cart),i.attr("data-max",t.surplus),i.find(".quantity-minus").prop("disabled",t.cart<1),i.find(".quantity-plus").prop("disabled",t.cart>=t.surplus),Zhai.cart.refresh()};a.find(".quantity-minus").click(function(){return Zhai.user.isGuest?(Zhai.user.showLogin(),!1):void Zhai.cart.subtract(s,o)}),a.find(".quantity-plus").click(function(){return Zhai.user.isGuest?(Zhai.user.showLogin(),!1):void Zhai.cart.add(s,o)})}},init:function(){this.baseUrl=$("meta[name=baseurl]").attr("content"),this.user.init(),this.cart.init(),this.detail.init()}},$(function(){Zhai.init(),$('[data-toggle="tooltip"]').tooltip(),$(".shopping-clear").click(function(){return Zhai.user.isGuest||Zhai.cart.clear(),!1}),$(".sale-item").each(Zhai.goods.traversalHandle),$(".link-cate").click(function(){var t=$($(this).attr("data-target"));return 1==t.length?($(window).scrollTop(t.offset().top),!1):!0});var t=!0,a=function(){t?($(".shopping-toggle button").addClass("active"),$(".shopping-cart").removeClass("shopping-cart-closed"),$('<div class="modal-backdrop backdrop-cart fade in"></div>').click(a).appendTo(document.body)):($(".shopping-toggle button").removeClass("active"),$(".shopping-cart").addClass("shopping-cart-closed"),$(".backdrop-cart").remove()),t=!t};$(".shopping-toggle button").click(a),$(".totop a").click(function(){return $(window).scrollTop(0),!1});var i=!0,s=function(){return i?($(".tool-searchbox").css("display","block").addClass("active"),$('<div class="modal-backdrop backdrop-searchbox fade in"></div>').click(s).appendTo(document.body)):($(".tool-searchbox").removeClass("active"),setTimeout(function(){$(".tool-searchbox").css("display","none")},400),$(".backdrop-searchbox").remove()),i=!i,!1};$(".tool-search a").click(s)});